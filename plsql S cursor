PRAC 6

CREATE TABLE N_RollCall (
    roll_no INT PRIMARY KEY,
    name VARCHAR(50)
);

CREATE TABLE O_RollCall (
    roll_no INT PRIMARY KEY,
    name VARCHAR(50)
);

INSERT INTO N_RollCall VALUES
(1, 'Siddhi'),
(2, 'Aditya'),
(3, 'Shreya');

INSERT INTO O_RollCall VALUES
(2, 'Aditya'),
(4, 'Aryan');

DELIMITER $$ 
CREATE PROCEDURE merge_rollcall()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE r INT;
    DECLARE n VARCHAR(50);
    DECLARE count_exist INT;

    -- Cursor to read all new rollcall entries
    DECLARE cur CURSOR FOR SELECT roll_no, name FROM N_RollCall;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

    OPEN cur;
    read_loop: LOOP
        FETCH cur INTO r, n;
        IF done THEN
            LEAVE read_loop;
        END IF;

        -- Check if record already exists
        SELECT COUNT(*) INTO count_exist FROM O_RollCall WHERE roll_no = r;

        IF count_exist = 0 THEN
            INSERT INTO O_RollCall VALUES (r, n);
        END IF;
    END LOOP;
    CLOSE cur;
END $$
DELIMITER ;




CALL merge_rollcall();

SELECT * FROM O_RollCall;
